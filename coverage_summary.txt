
> app@0.0.1 test:cov
> jest --coverage

PASS src/app.controller.spec.ts
PASS src/modules/assets/application/use-cases/find-asset-by-ticker.use-case.spec.ts
PASS src/modules/assets/application/use-cases/update-asset.use-case.spec.ts
PASS src/modules/assets/application/use-cases/create-asset.use-case.spec.ts
PASS src/modules/assets/application/use-cases/list-assets.use-case.spec.ts
PASS src/modules/assets/application/use-cases/find-asset.use-case.spec.ts
PASS src/modules/knowledge-base/application/use-cases/upload-philosophy.use-case.spec.ts
PASS src/modules/users/application/use-cases/list-users.use-case.spec.ts
PASS src/modules/knowledge-base/application/use-cases/ingest-philosophy.use-case.spec.ts
PASS src/modules/knowledge-base/application/use-cases/list-philosophies.use-case.spec.ts
PASS src/modules/users/application/use-cases/update-user.use-case.spec.ts
PASS src/modules/auth/application/use-cases/login.use-case.spec.ts
[31m[Nest] 1433  - [39m02/03/2026, 6:24:17 PM [31m  ERROR[39m [38;5;3m[DeletePhilosophyUseCase] [39m[31mError deleting file /usr/src/app/uploads/philosophies/file.pdf: File not found[39m
PASS src/modules/knowledge-base/application/use-cases/delete-philosophy.use-case.spec.ts
PASS src/modules/assets/application/use-cases/delete-asset.use-case.spec.ts
PASS src/modules/users/application/use-cases/find-user.use-case.spec.ts
PASS src/modules/users/application/use-cases/delete-user.use-case.spec.ts
PASS src/modules/users/application/use-cases/create-user.use-case.spec.ts
PASS src/modules/auth/application/use-cases/register.use-case.spec.ts
PASS src/modules/knowledge-base/services/rule-extraction.spec.ts (5.334 s)
-------------------------------------------------------|---------|----------|---------|---------|-------------------------
File                                                   | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s       
-------------------------------------------------------|---------|----------|---------|---------|-------------------------
All files                                              |   30.51 |    21.33 |    23.1 |   30.03 |                         
 src                                                   |   24.07 |       25 |      60 |   18.75 |                         
  app.controller.ts                                    |     100 |       75 |     100 |     100 | 6                       
  app.module.ts                                        |       0 |        0 |       0 |       0 | 1-67                    
  app.service.ts                                       |     100 |      100 |     100 |     100 |                         
  main.ts                                              |       0 |        0 |       0 |       0 | 1-77                    
 src/common/filters                                    |       0 |        0 |       0 |       0 |                         
  all-exceptions.filter.ts                             |       0 |        0 |       0 |       0 | 1-56                    
 src/common/middleware                                 |       0 |        0 |       0 |       0 |                         
  csrf.middleware.ts                                   |       0 |        0 |       0 |       0 | 1-34                    
 src/config                                            |       0 |        0 |       0 |       0 |                         
  multer.config.ts                                     |       0 |        0 |       0 |       0 | 1-51                    
 src/infrastructure/database                           |   85.71 |      100 |       0 |      80 |                         
  database.module.ts                                   |     100 |      100 |     100 |     100 |                         
  index.ts                                             |     100 |      100 |     100 |     100 |                         
  prisma.service.ts                                    |   71.42 |      100 |       0 |      60 | 7-11                    
 src/modules/alerts                                    |       0 |      100 |     100 |       0 |                         
  alerts.module.ts                                     |       0 |      100 |     100 |       0 | 1-29                    
 src/modules/alerts/application/dto                    |       0 |        0 |     100 |       0 |                         
  create-alert.dto.ts                                  |       0 |        0 |     100 |       0 | 1-17                    
  update-alert.dto.ts                                  |       0 |        0 |     100 |       0 | 1-20                    
 src/modules/alerts/application/use-cases              |       0 |        0 |       0 |       0 |                         
  check-alerts.use-case.ts                             |       0 |        0 |       0 |       0 | 1-81                    
  create-alert.use-case.ts                             |       0 |        0 |       0 |       0 | 1-38                    
  delete-alert.use-case.ts                             |       0 |        0 |       0 |       0 | 1-28                    
  list-alerts.use-case.ts                              |       0 |        0 |       0 |       0 | 1-27                    
  toggle-alert.use-case.ts                             |       0 |        0 |       0 |       0 | 1-29                    
  update-alert.use-case.ts                             |       0 |        0 |       0 |       0 | 1-31                    
 src/modules/alerts/domain/interfaces                  |       0 |        0 |       0 |       0 |                         
  alert.interface.ts                                   |       0 |        0 |       0 |       0 | 1-4                     
 src/modules/alerts/infrastructure/controllers         |       0 |        0 |       0 |       0 |                         
  alerts.controller.ts                                 |       0 |        0 |       0 |       0 | 1-62                    
 src/modules/alerts/infrastructure/jobs                |       0 |        0 |       0 |       0 |                         
  check-alerts.processor.ts                            |       0 |        0 |       0 |       0 | 1-21                    
 src/modules/alerts/infrastructure/services            |       0 |        0 |       0 |       0 |                         
  email-notification.service.ts                        |       0 |        0 |       0 |       0 | 1-61                    
 src/modules/analysis-engine                           |       0 |      100 |     100 |       0 |                         
  analysis-engine.module.ts                            |       0 |      100 |     100 |       0 | 1-8                     
  index.ts                                             |       0 |      100 |     100 |       0 | 1-2                     
 src/modules/analysis-engine/services                  |       0 |        0 |       0 |       0 |                         
  analysis-engine.service.ts                           |       0 |        0 |       0 |       0 | 1-249                   
 src/modules/assets                                    |       0 |      100 |     100 |       0 |                         
  assets.module.ts                                     |       0 |      100 |     100 |       0 | 1-42                    
  index.ts                                             |       0 |      100 |     100 |       0 | 1-4                     
 src/modules/assets/application/dtos                   |   97.91 |    63.33 |      50 |   97.91 |                         
  asset.output.ts                                      |     100 |       50 |     100 |     100 | 46-52                   
  create-asset.input.ts                                |      90 |       75 |       0 |      90 | 10                      
  index.ts                                             |     100 |      100 |     100 |     100 |                         
  update-asset.input.ts                                |     100 |       75 |     100 |     100 | 13-17                   
  update-indicators.input.ts                           |     100 |      100 |     100 |     100 |                         
 src/modules/assets/application/interfaces             |       0 |      100 |     100 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1                       
 src/modules/assets/application/use-cases              |   78.43 |    80.95 |   85.71 |    77.9 |                         
  create-asset.use-case.ts                             |     100 |      100 |     100 |     100 |                         
  delete-asset.use-case.ts                             |     100 |      100 |     100 |     100 |                         
  find-asset-by-ticker.use-case.ts                     |     100 |      100 |     100 |     100 |                         
  find-asset.use-case.ts                               |     100 |      100 |     100 |     100 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-7                     
  list-assets.use-case.ts                              |   94.11 |    77.77 |     100 |     100 | 32,37                   
  update-asset.use-case.ts                             |     100 |      100 |     100 |     100 |                         
  update-indicators.use-case.ts                        |       0 |        0 |       0 |       0 | 1-36                    
 src/modules/assets/domain/entities                    |      12 |        0 |      25 |      12 |                         
  asset.entity.ts                                      |      12 |        0 |      25 |      12 | 46-100                  
 src/modules/assets/domain/enums                       |     100 |      100 |     100 |     100 |                         
  asset-sector.enum.ts                                 |     100 |      100 |     100 |     100 |                         
  asset-type.enum.ts                                   |     100 |      100 |     100 |     100 |                         
 src/modules/assets/infrastructure/controllers         |       0 |        0 |       0 |       0 |                         
  assets.controller.ts                                 |       0 |        0 |       0 |       0 | 1-135                   
 src/modules/assets/infrastructure/repositories        |       0 |        0 |       0 |       0 |                         
  prisma-asset.repository.ts                           |       0 |        0 |       0 |       0 | 1-151                   
 src/modules/auth                                      |       0 |      100 |       0 |       0 |                         
  auth.module.ts                                       |       0 |      100 |       0 |       0 | 1-44                    
  index.ts                                             |       0 |      100 |     100 |       0 | 1-4                     
 src/modules/auth/application/dtos                     |     100 |      100 |     100 |     100 |                         
  auth.output.ts                                       |     100 |      100 |     100 |     100 |                         
  index.ts                                             |     100 |      100 |     100 |     100 |                         
  login.input.ts                                       |     100 |      100 |     100 |     100 |                         
  refresh-token.input.ts                               |     100 |      100 |     100 |     100 |                         
  register.input.ts                                    |     100 |      100 |     100 |     100 |                         
 src/modules/auth/application/use-cases                |   71.92 |    69.23 |   66.66 |   72.54 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-3                     
  login.use-case.ts                                    |     100 |    83.33 |     100 |     100 | 15                      
  refresh-token.use-case.ts                            |       0 |        0 |       0 |       0 | 1-24                    
  register.use-case.ts                                 |     100 |       80 |     100 |     100 | 15                      
 src/modules/auth/domain/services                      |      50 |    31.57 |       0 |   38.88 |                         
  password.service.ts                                  |    62.5 |      100 |       0 |      50 | 6-13                    
  token.service.ts                                     |   42.85 |    31.57 |       0 |   33.33 | 18-45                   
 src/modules/auth/infrastructure/controllers           |       0 |        0 |       0 |       0 |                         
  auth.controller.ts                                   |       0 |        0 |       0 |       0 | 1-96                    
 src/modules/auth/infrastructure/decorators            |       0 |      100 |       0 |       0 |                         
  current-user.decorator.ts                            |       0 |      100 |       0 |       0 | 1-6                     
 src/modules/auth/infrastructure/guards                |       0 |      100 |     100 |       0 |                         
  jwt-auth.guard.ts                                    |       0 |      100 |     100 |       0 | 1-5                     
 src/modules/auth/infrastructure/strategies            |       0 |        0 |       0 |       0 |                         
  jwt.strategy.ts                                      |       0 |        0 |       0 |       0 | 1-34                    
 src/modules/dashboard                                 |       0 |      100 |     100 |       0 |                         
  dashboard.module.ts                                  |       0 |      100 |     100 |       0 | 1-20                    
  index.ts                                             |       0 |      100 |     100 |       0 | 1                       
 src/modules/dashboard/application/use-cases           |       0 |        0 |       0 |       0 |                         
  get-dashboard-summary.use-case.ts                    |       0 |        0 |       0 |       0 | 1-49                    
  get-portfolio-performance.use-case.ts                |       0 |        0 |       0 |       0 | 1-55                    
  get-sector-distribution.use-case.ts                  |       0 |        0 |       0 |       0 | 1-56                    
  get-top-assets.use-case.ts                           |       0 |        0 |       0 |       0 | 1-47                    
 src/modules/dashboard/infrastructure/controllers      |       0 |        0 |       0 |       0 |                         
  dashboard.controller.ts                              |       0 |        0 |       0 |       0 | 1-68                    
 src/modules/jobs                                      |       0 |        0 |       0 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-2                     
  jobs.module.ts                                       |       0 |        0 |       0 |       0 | 1-29                    
 src/modules/jobs/infrastructure/controllers           |       0 |        0 |       0 |       0 |                         
  jobs.controller.ts                                   |       0 |        0 |       0 |       0 | 1-47                    
 src/modules/jobs/processors                           |       0 |        0 |       0 |       0 |                         
  sync-assets.processor.ts                             |       0 |        0 |       0 |       0 | 1-31                    
 src/modules/jobs/services                             |       0 |        0 |       0 |       0 |                         
  sync-assets.service.ts                               |       0 |        0 |       0 |       0 | 1-112                   
 src/modules/knowledge-base                            |       0 |      100 |       0 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-3                     
  knowledge-base.module.ts                             |       0 |      100 |       0 |       0 | 1-45                    
 src/modules/knowledge-base/application/dtos           |   75.86 |       75 |     100 |   75.86 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-2                     
  philosophy.output.ts                                 |     100 |       75 |     100 |     100 | 26-29                   
  upload-philosophy.input.ts                           |       0 |      100 |     100 |       0 | 1-18                    
 src/modules/knowledge-base/application/use-cases      |   90.24 |    72.72 |     100 |   89.04 |                         
  delete-philosophy.use-case.ts                        |      92 |       80 |     100 |    91.3 | 39-40                   
  index.ts                                             |       0 |      100 |     100 |       0 | 1-3                     
  ingest-philosophy.use-case.ts                        |     100 |       70 |     100 |     100 | 30,81-82                
  list-philosophies.use-case.ts                        |     100 |       75 |     100 |     100 | 7                       
  upload-philosophy.use-case.ts                        |   88.46 |       70 |     100 |    87.5 | 37,59-60                
 src/modules/knowledge-base/domain/entities            |   72.72 |    68.42 |     100 |   71.42 |                         
  strategy-profile.entity.ts                           |   72.72 |    68.42 |     100 |   71.42 | 49,53,55,59,61,65       
 src/modules/knowledge-base/infrastructure/controllers |       0 |        0 |       0 |       0 |                         
  philosophies.controller.ts                           |       0 |        0 |       0 |       0 | 1-84                    
 src/modules/knowledge-base/services                   |   45.74 |     61.7 |   23.07 |   43.52 |                         
  pdf-extractor.service.ts                             |      24 |        0 |       0 |   18.18 | 8-71                    
  prompt.service.ts                                    |   33.33 |        0 |       0 |      25 | 7-29                    
  rule-extraction.service.ts                           |   59.25 |    70.73 |   42.85 |   58.82 | 24,28-29,38,45-78,88-89 
 src/modules/knowledge-base/services/prompts           |   14.28 |        0 |       0 |   14.28 |                         
  default-rule-extraction.strategy.ts                  |   14.28 |        0 |       0 |   14.28 | 4-68                    
 src/modules/knowledge-base/services/providers         |   44.44 |    41.17 |      40 |   41.75 |                         
  gemini.provider.ts                                   |   73.07 |       55 |     100 |   70.83 | 23,56,69-94             
  openai.provider.ts                                   |   12.76 |    21.42 |       0 |     9.3 | 8-155                   
 src/modules/market-data                               |       0 |      100 |     100 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-3                     
  market-data.module.ts                                |       0 |      100 |     100 |       0 | 1-16                    
 src/modules/market-data/jobs                          |       0 |        0 |       0 |       0 |                         
  sync-market-data.processor.ts                        |       0 |        0 |       0 |       0 | 1-75                    
 src/modules/market-data/services                      |       0 |        0 |       0 |       0 |                         
  brapi.service.ts                                     |       0 |        0 |       0 |       0 | 1-80                    
  market-data.service.ts                               |       0 |        0 |       0 |       0 | 1-76                    
 src/modules/users                                     |       0 |      100 |     100 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-3                     
  users.module.ts                                      |       0 |      100 |     100 |       0 | 1-33                    
 src/modules/users/application/dtos                    |     100 |      100 |     100 |     100 |                         
  create-user.input.ts                                 |     100 |      100 |     100 |     100 |                         
  index.ts                                             |     100 |      100 |     100 |     100 |                         
  update-user.input.ts                                 |     100 |      100 |     100 |     100 |                         
  user.output.ts                                       |     100 |      100 |     100 |     100 |                         
 src/modules/users/application/interfaces              |       0 |      100 |     100 |       0 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1                       
 src/modules/users/application/use-cases               |   92.06 |      100 |     100 |   90.56 |                         
  create-user.use-case.ts                              |     100 |      100 |     100 |     100 |                         
  delete-user.use-case.ts                              |     100 |      100 |     100 |     100 |                         
  find-user.use-case.ts                                |     100 |      100 |     100 |     100 |                         
  index.ts                                             |       0 |      100 |     100 |       0 | 1-5                     
  list-users.use-case.ts                               |     100 |      100 |     100 |     100 |                         
  update-user.use-case.ts                              |     100 |      100 |     100 |     100 |                         
 src/modules/users/domain/entities                     |   42.85 |        0 |   33.33 |   42.85 |                         
  user.entity.ts                                       |   42.85 |        0 |   33.33 |   42.85 | 17-31                   
 src/modules/users/infrastructure/controllers          |       0 |        0 |       0 |       0 |                         
  users.controller.ts                                  |       0 |        0 |       0 |       0 | 1-94                    
 src/modules/users/infrastructure/repositories         |       0 |        0 |       0 |       0 |                         
  prisma-user.repository.ts                            |       0 |        0 |       0 |       0 | 1-83                    
-------------------------------------------------------|---------|----------|---------|---------|-------------------------

Test Suites: 19 passed, 19 total
Tests:       59 passed, 59 total
Snapshots:   0 total
Time:        10.669 s
Ran all test suites.
